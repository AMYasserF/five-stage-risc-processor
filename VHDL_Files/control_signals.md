# Control Unit Signals Reference

This document provides a complete reference of all control signals generated by the Control Unit for each instruction in the RISC processor ISA.

## Signal Descriptions

| Signal                 | Description                                             |
| ---------------------- | ------------------------------------------------------- |
| `mem_write`            | Enable memory write operation                           |
| `mem_read`             | Enable memory read operation                            |
| `mem_to_reg`           | Select memory data to write to register (vs ALU result) |
| `alu_op`               | 4-bit ALU operation code                                |
| `out_enable`           | Enable output to I/O port                               |
| `is_swap`              | Indicates SWAP instruction                              |
| `swap_phase`           | SWAP operation phase control                            |
| `reg_write`            | Enable register file write                              |
| `is_immediate`         | Instruction has immediate value in next word            |
| `is_call`              | Indicates CALL instruction                              |
| `hlt`                  | Halt processor                                          |
| `is_int`               | Indicates INT (interrupt) instruction                   |
| `is_pop`               | Indicates POP instruction                               |
| `is_push`              | Indicates PUSH instruction                              |
| `int_phase`            | Interrupt operation phase                               |
| `is_rti`               | Indicates RTI (return from interrupt)                   |
| `rti_phase`            | RTI operation phase                                     |
| `is_ret`               | Indicates RET (return) instruction                      |
| `branchZ`              | Branch if Zero flag is set                              |
| `branchC`              | Branch if Carry flag is set                             |
| `branchN`              | Branch if Negative flag is set                          |
| `unconditional_branch` | Unconditional branch (JMP)                              |

## R-Type Instructions (Type=00, hasImm=0)

### NOP (Opcode: 0000000)

| Signal                 | Value | Notes             |
| ---------------------- | ----- | ----------------- |
| `mem_write`            | 0     | No memory write   |
| `mem_read`             | 0     | No memory read    |
| `mem_to_reg`           | 0     | N/A               |
| `alu_op`               | 0000  | No operation      |
| `out_enable`           | 0     | No output         |
| `is_swap`              | 0     | Not a swap        |
| `swap_phase`           | 0     | N/A               |
| `reg_write`            | 0     | No register write |
| `is_immediate`         | 0     | No immediate      |
| `is_call`              | 0     | Not a call        |
| `hlt`                  | 0     | No halt           |
| `is_int`               | 0     | Not an interrupt  |
| `is_pop`               | 0     | Not a pop         |
| `is_push`              | 0     | Not a push        |
| `int_phase`            | 0     | N/A               |
| `is_rti`               | 0     | Not RTI           |
| `rti_phase`            | 0     | N/A               |
| `is_ret`               | 0     | Not a return      |
| `branchZ`              | 0     | No branch         |
| `branchC`              | 0     | No branch         |
| `branchN`              | 0     | No branch         |
| `unconditional_branch` | 0     | No branch         |

### SETC (Opcode: 0000001)

| Signal            | Value | Notes                 |
| ----------------- | ----- | --------------------- |
| `mem_write`       | 0     | No memory write       |
| `mem_read`        | 0     | No memory read        |
| `mem_to_reg`      | 0     | N/A                   |
| `alu_op`          | 0001  | SETC (Set Carry flag) |
| `out_enable`      | 0     | No output             |
| `is_swap`         | 0     | Not a swap            |
| `swap_phase`      | 0     | N/A                   |
| `reg_write`       | 0     | No register write     |
| `is_immediate`    | 0     | No immediate          |
| All other signals | 0     | Default               |

### NOT (Opcode: 0000010)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 0100  | NotA (Bitwise NOT) |
| `reg_write`       | 1     | Write result to Rd |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

### INC (Opcode: 0000011)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 0101  | IncA (Increment)   |
| `reg_write`       | 1     | Write result to Rd |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

### OUT (Opcode: 0000100)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 0010  | PassA              |
| `out_enable`      | 1     | Enable output port |
| `reg_write`       | 0     | No register write  |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

### IN (Opcode: 0000101)

| Signal            | Value | Notes                   |
| ----------------- | ----- | ----------------------- |
| `alu_op`          | 0011  | PassB (from input port) |
| `reg_write`       | 1     | Write input to Rd       |
| `is_immediate`    | 0     | No immediate            |
| All other signals | 0     | Default                 |

### MOV (Opcode: 0000110)

| Signal            | Value | Notes           |
| ----------------- | ----- | --------------- |
| `alu_op`          | 0010  | PassA           |
| `reg_write`       | 1     | Write Rs1 to Rd |
| `is_immediate`    | 0     | No immediate    |
| All other signals | 0     | Default         |

### SWAP (Opcode: 0000111)

| Signal            | Value | Notes                                                                                                    |
| ----------------- | ----- | -------------------------------------------------------------------------------------------------------- |
| `alu_op`          | 0111  | SWAP (in our implemenation we use passA) and pass the anthor additonal wire to pass the another register |
| `is_swap`         | 1     | SWAP instruction                                                                                         |
| `reg_write`       | 1     | Write to registers                                                                                       |
| `is_immediate`    | 0     | No immediate                                                                                             |
| All other signals | 0     | Default                                                                                                  |

### ADD (Opcode: 0001000)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 1000  | ADD                |
| `reg_write`       | 1     | Write result to Rd |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

### SUB (Opcode: 0001001)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 1001  | SUB                |
| `reg_write`       | 1     | Write result to Rd |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

### AND (Opcode: 0001010)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `alu_op`          | 0110  | AND                |
| `reg_write`       | 1     | Write result to Rd |
| `is_immediate`    | 0     | No immediate       |
| All other signals | 0     | Default            |

## I-Type Instructions (Type=01, hasImm=1)

### IADD (Opcode: 1010001)

| Signal            | Value | Notes                  |
| ----------------- | ----- | ---------------------- |
| `alu_op`          | 1000  | ADD                    |
| `reg_write`       | 1     | Write result to Rd     |
| `mem_to_reg`      | 0     | ALU result to register |
| `is_immediate`    | 1     | Has immediate value    |
| All other signals | 0     | Default                |

### LDM (Opcode: 1010010)

| Signal            | Value | Notes                 |
| ----------------- | ----- | --------------------- |
| `alu_op`          | 0011  | PassB (immediate)     |
| `reg_write`       | 1     | Write immediate to Rd |
| `mem_to_reg`      | 0     | Immediate to register |
| `is_immediate`    | 1     | Has immediate value   |
| All other signals | 0     | Default               |

### LDD (Opcode: 1010011)

| Signal            | Value | Notes                   |
| ----------------- | ----- | ----------------------- |
| `alu_op`          | 1000  | ADD (Rs1 + offset)      |
| `reg_write`       | 1     | Write memory data to Rd |
| `mem_read`        | 1     | Read from memory        |
| `mem_to_reg`      | 1     | Memory data to register |
| `is_immediate`    | 1     | Has offset immediate    |
| All other signals | 0     | Default                 |

### STD (Opcode: 1010100)

| Signal            | Value | Notes                |
| ----------------- | ----- | -------------------- |
| `alu_op`          | 1000  | ADD (Rs2 + offset)   |
| `mem_write`       | 1     | Write to memory      |
| `reg_write`       | 0     | No register write    |
| `is_immediate`    | 1     | Has offset immediate |
| All other signals | 0     | Default              |

## J-Type Instructions (Type=10)

### JMP (Opcode: 1100001, hasImm=1)

| Signal                 | Value | Notes              |
| ---------------------- | ----- | ------------------ |
| `unconditional_branch` | 1     | Unconditional jump |
| `alu_op`               | 0000  | No ALU operation   |
| `is_immediate`         | 1     | Has target address |
| All other signals      | 0     | Default            |

### JZ (Opcode: 1100010, hasImm=1)

| Signal            | Value | Notes                 |
| ----------------- | ----- | --------------------- |
| `branchZ`         | 1     | Jump if Zero flag set |
| `alu_op`          | 0000  | No ALU operation      |
| `is_immediate`    | 1     | Has target address    |
| All other signals | 0     | Default               |

### JN (Opcode: 1100011, hasImm=1)

| Signal            | Value | Notes                     |
| ----------------- | ----- | ------------------------- |
| `branchN`         | 1     | Jump if Negative flag set |
| `alu_op`          | 0000  | No ALU operation          |
| `is_immediate`    | 1     | Has target address        |
| All other signals | 0     | Default                   |

### JC (Opcode: 1100100, hasImm=1)

| Signal            | Value | Notes                  |
| ----------------- | ----- | ---------------------- |
| `branchC`         | 1     | Jump if Carry flag set |
| `alu_op`          | 0000  | No ALU operation       |
| `is_immediate`    | 1     | Has target address     |
| All other signals | 0     | Default                |

### CALL (Opcode: 1100101, hasImm=1)

| Signal            | Value | Notes              |
| ----------------- | ----- | ------------------ |
| `is_call`         | 1     | Call subroutine    |
| `alu_op`          | 0000  | No ALU operation   |
| `is_immediate`    | 1     | Has target address |
| All other signals | 0     | Default            |

### RET (Opcode: 0100110, hasImm=0)

| Signal            | Value | Notes                                   |
| ----------------- | ----- | --------------------------------------- |
| `is_ret`          | 1     | Return from subroutine                  |
| `alu_op`          | 0000  | No ALU operation                        |
| `is_immediate`    | 0     | No immediate (returns to saved address) |
| All other signals | 0     | Default                                 |

## System/Stack Instructions (Type=11)

### PUSH (Opcode: 0110001, hasImm=0)

| Signal            | Value | Notes            |
| ----------------- | ----- | ---------------- |
| `is_push`         | 1     | Push operation   |
| `mem_write`       | 1     | Write to stack   |
| `alu_op`          | 0000  | No ALU operation |
| `is_immediate`    | 0     | No immediate     |
| All other signals | 0     | Default          |

### POP (Opcode: 0110010, hasImm=0)

| Signal            | Value | Notes                   |
| ----------------- | ----- | ----------------------- |
| `is_pop`          | 1     | Pop operation           |
| `mem_read`        | 1     | Read from stack         |
| `mem_to_reg`      | 1     | Memory data to register |
| `reg_write`       | 1     | Write to Rd             |
| `alu_op`          | 0000  | No ALU operation        |
| `is_immediate`    | 0     | No immediate            |
| All other signals | 0     | Default                 |

### INT (Opcode: 1110011, hasImm=1)

| Signal            | Value | Notes                   |
| ----------------- | ----- | ----------------------- |
| `is_int`          | 1     | Software interrupt      |
| `int_phase`       | 0     | Interrupt phase control |
| `alu_op`          | 0000  | No ALU operation        |
| `is_immediate`    | 1     | Has interrupt number    |
| All other signals | 0     | Default                 |

### RTI (Opcode: 0110100, hasImm=0)

| Signal            | Value | Notes                 |
| ----------------- | ----- | --------------------- |
| `is_rti`          | 1     | Return from interrupt |
| `rti_phase`       | 0     | RTI phase control     |
| `alu_op`          | 0000  | No ALU operation      |
| `is_immediate`    | 0     | No immediate          |
| All other signals | 0     | Default               |

### HLT (Opcode: 0110101, hasImm=0)

| Signal            | Value | Notes            |
| ----------------- | ----- | ---------------- |
| `hlt`             | 1     | Halt processor   |
| `alu_op`          | 0000  | No ALU operation |
| `is_immediate`    | 0     | No immediate     |
| All other signals | 0     | Default          |

## Special Cases

### Previous Instruction Had Immediate (previous_is_immediate = '1')

When `previous_is_immediate` is '1', all control signals are set to '0'. This allows the immediate value (second word) to pass through the pipeline without executing any operations.

| All Signals         | Value |
| ------------------- | ----- |
| All control signals | 0     |

This prevents the immediate data word from being interpreted as an instruction.

## ALU Operation Codes

| ALU_OP | Binary | Operation | Description            |
| ------ | ------ | --------- | ---------------------- |
| 0      | 0000   | NOP       | No operation           |
| 1      | 0001   | SETC      | Set Carry flag         |
| 2      | 0010   | PassA     | Pass operand A through |
| 3      | 0011   | PassB     | Pass operand B through |
| 4      | 0100   | NotA      | Bitwise NOT of A       |
| 5      | 0101   | IncA      | Increment A by 1       |
| 6      | 0110   | AND       | Bitwise AND of A and B |
| 7      | 0111   | SWAP      | Swap operands          |
| 8      | 1000   | ADD       | Add A + B              |
| 9      | 1001   | SUB       | Subtract A - B         |

## Opcode Format

```
Bit [6]     - hasImm flag (1 = next word contains immediate/address)
Bits [5:4]  - Type (00=R, 01=I, 10=J, 11=System)
Bits [3:0]  - Function code (specific instruction within type)
```

### Type Encoding

- `00` - R-Type (Register operations)
- `01` - I-Type (Immediate operations)
- `10` - J-Type (Jump/Branch operations)
- `11` - System/Stack operations

## Notes

1. **Immediate Handling**: Instructions with `is_immediate = 1` have a second word containing the immediate value or target address.

2. **Memory Operations**:

   - `LDD` and `POP` use `mem_to_reg = 1` to write memory data to registers
   - `STD` and `PUSH` use `mem_write = 1` to write to memory
   - `LDD`, `LDM`, and `POP` use `mem_read = 1` to read from memory

3. **Branch Operations**: Branch signals (`branchZ`, `branchC`, `branchN`, `unconditional_branch`) are mutually exclusive.

4. **Register Write**: Most arithmetic and data movement instructions set `reg_write = 1` to update the destination register.

5. **Special Instructions**:
   - `SWAP` uses `is_swap` flag for special handling in the pipeline
   - `CALL`, `RET`, `INT`, `RTI` require special control for PC and stack management
   - `HLT` stops the processor execution
